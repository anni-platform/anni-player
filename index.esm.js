import{useMemo as t,useRef as e,useReducer as n,useEffect as r}from"react";const i=24,o=t=>new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=t=>n(t),r.src=t}),a=(t,e)=>({...t,...e});function c(t){try{const e=t.split("/").pop(),[n]=e.split("."),[r]=/\d+/.exec(n);if(!r)throw Error();return parseInt(r,10)}catch(e){console.error(`"${t}" does not contain a valid frame index`)}}function s(t,e){return c(t)-c(e)}export default function({fps:c=i,frames:l=[]}){const h=t(()=>l.sort(s),[l]),u=e(null),m=e(),g=e(null),[f,d]=n(a,{currentFrame:0,isPlaying:!1,htmlImageElements:[]}),{isPlaying:w,htmlImageElements:p}=f;function y(t){t&&g.current&&(g.current.width=t.width,g.current.height=t.height,g.current.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,t.width,t.height))}return r(()=>{g&&async function(){const t=await Promise.all(h.map(t=>o(t)));if(!t||0===t.length)return;const{width:e,height:n}=t[0];d({htmlImageElements:t,frameSize:{width:e,height:n}}),y(t[0])}()},[l,g,h]),r(()=>{if(w){if(!f.isPlaying)return;let t,e,n=performance.now();const r=()=>{if(!f.isPlaying)return;t=performance.now(),e=t-n;const i=Math.round(1e3/c);if(e>i){const e=u.current;n=t,u.current=e===l.length-1?0:e+1,y(p[u.current])}m.current=requestAnimationFrame(r)};r()}else m.current&&cancelAnimationFrame(m.current)},[c,l.length,p,w,f.isPlaying]),{...f,canvasRef:g,togglePlay:function(){const t=p.length>0&&!w;d({isPlaying:t})},sortedFrames:h}}export{c as extractFrameIndexFromPath};
