"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var react=require("react");const DEFAULT_FPS=24,preloadImagePromise=e=>new Promise((r,t)=>{const n=new Image;n.onload=()=>r(n),n.onerror=e=>t(e),n.src=e}),reducer=(e,r)=>({...e,...r});function extractFrameIndexFromPath(e){try{const r=e.split("/").pop(),[t]=r.split("."),[n]=/\d+/.exec(t);if(!n)throw Error();return parseInt(n,10)}catch(r){console.error(`"${e}" does not contain a valid frame index`)}}function sortFramesAscending(e,r){return extractFrameIndexFromPath(e)-extractFrameIndexFromPath(r)}function useCanvasScrubber({fps:e=DEFAULT_FPS,frames:r=[]}){const t=react.useMemo(()=>r.sort(sortFramesAscending),[r]),n=react.useRef(null),a=react.useRef(),c=react.useRef(null),[s,o]=react.useReducer(reducer,{currentFrame:0,isPlaying:!1,htmlImageElements:[]}),{isPlaying:i,htmlImageElements:u}=s;function m(e){e&&c.current&&(c.current.width=e.width,c.current.height=e.height,c.current.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height))}return react.useEffect(()=>{c&&async function(){const e=await Promise.all(t.map(e=>preloadImagePromise(e)));if(!e||0===e.length)return;const{width:r,height:n}=e[0];o({htmlImageElements:e,frameSize:{width:r,height:n}}),m(e[0])}()},[r,c,t]),react.useEffect(()=>{if(i){if(!s.isPlaying)return;let t,c,o=performance.now();const i=()=>{if(!s.isPlaying)return;t=performance.now(),c=t-o;const l=Math.round(1e3/e);if(c>l){const e=n.current;o=t,n.current=e===r.length-1?0:e+1,m(u[n.current])}a.current=requestAnimationFrame(i)};i()}else a.current&&cancelAnimationFrame(a.current)},[e,r.length,u,i,s.isPlaying]),{...s,canvasRef:c,togglePlay:function(){const e=u.length>0&&!i;o({isPlaying:e})},sortedFrames:t}}exports.extractFrameIndexFromPath=extractFrameIndexFromPath,exports.default=useCanvasScrubber;
